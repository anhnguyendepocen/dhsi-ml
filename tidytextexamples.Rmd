---
title: "tidy text"
output:
  html_document: default
---

# Introduction to R

- What topics should be covered? Cover only topics that are needed: data frames, basic ggplot, merging in dplyr (inner_join, etc.). 

- Should these be done separately or in the context of examples?

1. data acquisition 
2. data wrangling
3. data analysis
4. imterpretation

data:

1. twitter
2. guten 
3. hillary e-mails
4. media yahoo


Paul access to github.
send paul all my files

# Case study #1 - "Gotta Serve Somebody"
## tidy text and Data Vizualization


Some text from the Bob Dylan song,  "Gotta Serve Somebody" 

```{r}
bd_text <- c("You may be an ambassador to England or France -",
"You may like to gamble, you might like to dance -",
"You may be the heavyweight champion of the world  -",
"You may be a socialite with a long string of pearls -",
"But you're gonna have to serve somebody, yes -",
"Indeed you're gonna have to serve somebody -",
"Well, it may be the devil or it may be the Lord -",
"But you're gonna have to serve somebody -")

bd_text
```

Now let's turn it into a tidy text dataset.  First put the text into a data frame

```{r}
library(dplyr)
bd_text_df <- data_frame(line=1:8,text=bd_text)
bd_text_df
```

A *token* is a meaningful unit of text, such as a word, that we are intrested in using for analysis. Tokenization is the process of splitting text into tokens.  

A text is ready for analysis if it has one-token-per-row.  A token is often a single word but it could also be a sentence or a paragraph. 

The tidytext paackage provides functionality to convert to a one-term-per-row format.

We can use `unnest_tokens()` to break the the text into tokens.

```{r}
library(tidytext)
bd_text_df %>% unnest_tokens(word,text)
```

We can use the `count()` function in the dplyr library to find the most common words in the text.

```{r}
bd_text_df %>% unnest_tokens(word,text) %>% count(word,sort=TRUE)
```

We can create a plot of these frequencies using the ggplot2 library.

```{r}
library(ggplot2)

bd_text_df %>% unnest_tokens(word,text) %>% count(word,sort=TRUE) %>%
mutate(word=reorder(word,n)) %>%
  ggplot(aes(word,n)) +
  geom_col() +
  xlab(NULL) +
  coord_flip()
```

# Case study #2 - H.G. Wells and Bront&euml; sisters
## Data Wrangling and Statistical Analysis

H. G. Wells books: The Time Machine, The War of the Worlds, The Invisible Man, and The Island of Doctor Moreau. 

```{r}
library(gutenbergr)
hgwells <- gutenberg_download(c(35, 36, 5230, 159))

tidy_hgwells <- hgwells %>%
  unnest_tokens(word, text) %>%
  anti_join(stop_words)

```

What are the most common words in these novels?

```{r}
library(stringr)
library(dplyr)
tidy_hgwells <- tidy_hgwells %>% mutate(word = str_extract(word, "[a-z']+")) %>% 
  count(word,sort=T) 
```

*Add some notes about regular expressions.*

Now get works of Bront&euml; sisters. 

```{r}
bronte <- gutenberg_download(c(1260, 768, 969, 9182, 767))

tidy_bronte <- bronte %>%
  unnest_tokens(word, text) %>%
  anti_join(stop_words)
```

What are the most common words in these novels of the Bront&euml; sisters?

```{r}
tidy_bronte <- tidy_bronte  %>% mutate(word = str_extract(word, "[a-z']+")) %>% 
  count(word,sort=T) 
```

Let's calculate the relative frequencies for each word for the works of Jane Austen and the Bront&euml; sisters and plot.


```{r,cache=TRUE}
library(dplyr)
library(tidytext)
library(tidyr)
library(stringr)
library(gmodels)
library(ggplot2)
library(scales)

comparison <- tidy_bronte %>% inner_join(tidy_hgwells,by="word")  %>% mutate(freq_bronte=n.x/sum(n.x),freq_wells=n.y/sum(n.y))


ggplot(comparison, aes(freq_bronte,freq_wells))+geom_point()+
  geom_text(aes(label = word), check_overlap = TRUE, vjust = 1, hjust = 1) +
  scale_x_log10(labels = percent_format()) +
  scale_y_log10(labels = percent_format()) +
  geom_abline(color = "red")


```

What have we plotted? How can we interpret this plot? Is it meaningful? 

All the words that appear in both texts.  But, among all words in the text how many appear in one text and not the other?

```{r}
library(gmodels)
library(dplyr)
comparison_all <- tidy_bronte %>% full_join(tidy_hgwells,by="word") %>% 
  mutate(br_in=if_else(is.na(n.x),0,1),well_in=if_else(is.na(n.y),0,1))
with(comparison_all, CrossTable(br_in,well_in,prop.chisq = F))
```

This table tells us that there are 11,710 words in Well's works, and 8,307 (71%) of these words appear in Bront&euml; sisters works.  Conversely, there are 22,678 words that appear in Bront&euml; sister's works and 8,307 (37%) of these words appear in Well's works.  

- If a word is randomly selected in one of the Well's novels then there is a 71% chance that it will also appear in the Bront&euml; sisters works.

- If a word is randomly selected in one of the Bront&euml; sisters works then there is a 37% chance that it will also appear in the Well's novels.

Did Wells influence the Bront&euml; sisters?


